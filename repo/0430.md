# 2022/4/30 交流

- 加了代码注释和文档，新增 `doc` 目录，针对每个模块的OS整体设计有比较详细的解释

- 修改了 `main.rs` 中原子变量的设计，现在可以正常在启动时 clear_bss 了

- 调整 `task` 模块，分离任务调度器和TCB本体：
- - 任务调度器中只存 `Arc<TaskControlBlock>`，如(这两天马上会加的)`fork`过程，一个核可以自己做完复制地址空间核页表的之后再调用调度器把TCB存进去，不用一直占着 `TaskManagerInner` 的锁。

- 和张译仁学长等交流文档和设计后更新了一些设计(`sstatus-SUM` 位在启动设置、任务管理时拿锁和释放锁的时机等)

- 在 trap_handler 函数调用过程中，通过 `extern "C"` 引用汇编中的标识时，有时得到实际编译链接时的物理地址，有时又会得到内核开页表后的虚拟地址。
- - 这个问题可能比较复杂，和 rust 编译用 debug / release 有关，跟 sbi 提供的 `print` 的位置也有关。跟张译仁学长正在交流这个问题，他建议是 `objdump` 仔细看出汇编。